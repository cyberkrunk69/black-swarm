<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Parallel Execution Timeline</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        body { margin:0; font-family: Arial, sans-serif; }
        #chart { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
<div id="chart"></div>

<script>
// Example data structure expected from the backend.
// Replace this with a fetch call or server‑side injection as needed.
const tasks = [
    // {id, name, start, end, workerSlot, originFile}
    {id: 1, name: "Task A", start: "2026-02-04T10:00:00Z", end: "2026-02-04T10:05:00Z", workerSlot: 1, originFile: "module_a.py"},
    {id: 2, name: "Task B", start: "2026-02-04T10:02:00Z", end: "2026-02-04T10:07:00Z", workerSlot: 2, originFile: "module_b.py"},
    {id: 3, name: "Task C", start: "2026-02-04T10:04:00Z", end: "2026-02-04T10:09:00Z", workerSlot: 1, originFile: "module_a.py"},
    // ... more tasks
];

// Build Plotly traces per worker slot
const slots = [...new Set(tasks.map(t => t.workerSlot))].sort((a,b)=>a-b);
const colors = Plotly.d3.scaleOrdinal(Plotly.d3.schemeCategory10);

const data = slots.map(slot => {
    const slotTasks = tasks.filter(t => t.workerSlot === slot);
    return {
        type: 'bar',
        orientation: 'h',
        y: slotTasks.map(t => `Worker ${slot}`),
        x: slotTasks.map(t => new Date(t.end) - new Date(t.start)),
        base: slotTasks.map(t => new Date(t.start)),
        text: slotTasks.map(t => `${t.name}<br>${t.originFile}`),
        hoverinfo: 'text',
        marker: {
            color: slotTasks.map(t => colors(t.originFile)),
        },
        width: 0.6,
        name: `Worker ${slot}`
    };
});

const layout = {
    title: 'Parallel Execution Timeline',
    barmode: 'stack',
    xaxis: {
        type: 'date',
        title: 'Time',
    },
    yaxis: {
        automargin: true,
        tickmode: 'array',
        tickvals: slots.map(s => `Worker ${s}`),
        title: 'Worker Slot',
    },
    hovermode: 'closest',
    showlegend: false,
    height: slots.length * 80 + 150,
};

Plotly.newPlot('chart', data, layout, {responsive: true});

// Enable zoom and pan (Plotly provides this out‑of‑the‑box)
// If you want custom controls you can add them here.
</script>
</body>
</html>