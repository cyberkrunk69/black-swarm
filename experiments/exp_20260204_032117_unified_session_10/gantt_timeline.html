<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parallel Execution Timeline (Gantt)</title>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <style>
    body { margin:0; font-family:Arial, sans-serif; }
    #chart { width:100vw; height:100vh; }
  </style>
</head>
<body>
<div id="chart"></div>

<script>
// Sample data â€“ replace with real execution logs
const tasks = [
  // {file: 'task_a.py', start: '2026-02-04 10:00', end: '2026-02-04 10:05', slot: 0},
  // {file: 'task_b.py', start: '2026-02-04 10:02', end: '2026-02-04 10:07', slot: 1},
  // {file: 'task_c.py', start: '2026-02-04 10:04', end: '2026-02-04 10:09', slot: 0},
];

// Utility to generate random colors per file origin
const colorMap = {};
function getColor(file) {
  if (!colorMap[file]) {
    const hue = Math.floor(Math.random() * 360);
    colorMap[file] = `hsl(${hue},70%,60%)`;
  }
  return colorMap[file];
}

// Convert task objects to Plotly bar traces
function buildTraces(data) {
  const slots = [...new Set(data.map(t => t.slot))].sort((a,b)=>a-b);
  const traces = slots.map(slot => {
    const slotTasks = data.filter(t => t.slot === slot);
    return {
      type: 'bar',
      orientation: 'h',
      y: slotTasks.map(t => `Slot ${slot}`),
      x: slotTasks.map(t => (new Date(t.end) - new Date(t.start)) / 1000), // seconds duration
      base: slotTasks.map(t => new Date(t.start)),
      text: slotTasks.map(t => t.file),
      hovertemplate: `<b>%{text}</b><br>Start: %{base}<br>End: %{x}s`,
      marker: {
        color: slotTasks.map(t => getColor(t.file))
      },
      showlegend: false
    };
  });
  return traces;
}

// Example placeholder data for demo
const exampleData = [
  {file: 'src/task_a.py', start: '2026-02-04T10:00:00', end: '2026-02-04T10:05:00', slot: 0},
  {file: 'src/task_b.py', start: '2026-02-04T10:02:00', end: '2026-02-04T10:07:00', slot: 1},
  {file: 'src/task_c.py', start: '2026-02-04T10:04:00', end: '2026-02-04T10:09:00', slot: 0},
  {file: 'src/task_d.py', start: '2026-02-04T10:06:00', end: '2026-02-04T10:12:00', slot: 2},
];

// Build and render
const traces = buildTraces(exampleData);
Plotly.newPlot('chart', traces, {
  barmode: 'stack',
  title: 'Parallel Execution Timeline',
  xaxis: {
    type: 'date',
    title: 'Time',
    rangeselector: {buttons: [
      {count: 1, label: '1h', step: 'hour', stepmode: 'backward'},
      {count: 6, label: '6h', step: 'hour', stepmode: 'backward'},
      {step: 'all'}
    ]},
    rangeslider: {visible: true},
    tickformat: '%H:%M:%S'
  },
  yaxis: {
    title: 'Worker Slot',
    automargin: true,
    tickmode: 'array',
    tickvals: exampleData.map(t => `Slot ${t.slot}`),
    ticktext: exampleData.map(t => `Slot ${t.slot}`)
  },
  hovermode: 'closest',
  margin: {l:80, r:20, t:40, b:40}
}, {
  responsive: true,
  scrollZoom: true
});
</script>
</body>
</html>