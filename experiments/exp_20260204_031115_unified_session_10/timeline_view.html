<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Parallel Execution Timeline</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body { margin:0; font-family:Arial, sans-serif; }
        #chart { width: 100%; height: 100vh; }
    </style>
</head>
<body>
<div id="chart"></div>

<script>
// Sample data format:
// [
//   {"task":"Task A","slot":0,"start":"2026-02-04T10:00:00Z","end":"2026-02-04T10:15:00Z","origin":"module1.py"},
//   {"task":"Task B","slot":1,"start":"2026-02-04T10:05:00Z","end":"2026-02-04T10:20:00Z","origin":"module2.py"},
//   ...
// ]
// In production replace the below with a fetch to your real data source.
const sampleData = [
    {"task":"Load Data","slot":0,"start":"2026-02-04T09:00:00Z","end":"2026-02-04T09:05:00Z","origin":"loader.py"},
    {"task":"Preprocess","slot":0,"start":"2026-02-04T09:05:00Z","end":"2026-02-04T09:20:00Z","origin":"preprocess.py"},
    {"task":"Train Model","slot":1,"start":"2026-02-04T09:10:00Z","end":"2026-02-04T09:45:00Z","origin":"trainer.py"},
    {"task":"Validate","slot":2,"start":"2026-02-04T09:30:00Z","end":"2026-02-04T09:40:00Z","origin":"validator.py"},
    {"task":"Report","slot":1,"start":"2026-02-04T09:45:00Z","end":"2026-02-04T09:55:00Z","origin":"reporter.py"}
];

// Generate a color map based on file origin
const origins = [...new Set(sampleData.map(d => d.origin))];
const colors = Plotly.d3.schemeCategory10;
const originColorMap = {};
origins.forEach((origin, i) => {
    originColorMap[origin] = colors[i % colors.length];
});

// Convert data to Plotly Gantt compatible format
const plotData = sampleData.map(d => ({
    x: [new Date(d.start), new Date(d.end)],
    y: [`Slot ${d.slot}`, `Slot ${d.slot}`],
    mode: 'lines',
    line: {
        color: originColorMap[d.origin],
        width: 20,
        shape: 'hv'
    },
    name: d.task,
    hoverinfo: 'text',
    text: `Task: ${d.task}<br>Origin: ${d.origin}<br>Start: ${d.start}<br>End: ${d.end}`
}));

const layout = {
    title: 'Parallel Execution Timeline',
    showlegend: false,
    yaxis: {
        type: 'category',
        autorange: 'reversed',
        tickmode: 'array',
        tickvals: origins.map((_, i) => `Slot ${i}`),
        ticktext: origins.map((_, i) => `Slot ${i}`)
    },
    xaxis: {
        type: 'date',
        rangeselector: {buttons: [
            {count: 1, label: '1h', step: 'hour', stepmode: 'backward'},
            {count: 6, label: '6h', step: 'hour', stepmode: 'backward'},
            {step: 'all'}
        ]},
        rangeslider: {visible: true},
        title: 'Time'
    },
    dragmode: 'pan',
    hovermode: 'closest'
};

Plotly.newPlot('chart', plotData, layout, {responsive: true});
</script>
</body>
</html>