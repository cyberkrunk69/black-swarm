<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Parallel Execution Timeline (Gantt)</title>
    <style>
        body { font-family: Arial, sans-serif; margin:0; padding:0; }
        #chart { width: 100%; height: 100vh; }
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        .task {
            stroke: #000;
            stroke-width: 1px;
        }
        .tooltip {
            position: absolute;
            padding: 5px 10px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            border-radius: 3px;
            pointer-events: none;
            font-size: 12px;
            visibility: hidden;
        }
    </style>
</head>
<body>
<div id="chart"></div>
<div class="tooltip" id="tooltip"></div>

<!-- D3.js v7 -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// Sample data format (replace with real data via server or embed)
// Each entry: {task: "Task name", file: "origin_file.py", start: timestamp, end: timestamp, worker: slotNumber}
const data = [
    // Example entries
    {task:"LoadData", file:"loader.py", start:1620000000000, end:1620000015000, worker:0},
    {task:"Preprocess", file:"preprocess.py", start:1620000010000, end:1620000030000, worker:1},
    {task:"TrainModel", file:"trainer.py", start:1620000030000, end:1620000060000, worker:0},
    {task:"Validate", file:"validator.py", start:1620000055000, end:1620000070000, worker:2}
];

// Color scale by file origin
const fileSet = Array.from(new Set(data.map(d=>d.file)));
const color = d3.scaleOrdinal()
    .domain(fileSet)
    .range(d3.schemeCategory10);

// Dimensions
const margin = {top: 20, right: 20, bottom: 30, left: 80};
let width = document.body.clientWidth - margin.left - margin.right;
let height = document.body.clientHeight - margin.top - margin.bottom;

// Scales
const x = d3.scaleTime()
    .domain(d3.extent(data.flatMap(d=>[d.start, d.end])))
    .range([0, width]);

const y = d3.scaleBand()
    .domain(d3.range(d3.max(data, d=>d.worker)+1))
    .range([0, height])
    .padding(0.2);

// SVG container
const svg = d3.select("#chart")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .call(d3.zoom().scaleExtent([0.5, 5]).on("zoom", zoomed))
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

// Axes
const xAxis = d3.axisBottom(x);
const yAxis = d3.axisLeft(y).tickFormat(d=>`Worker ${d}`);

svg.append("g")
    .attr("class","x axis")
    .attr("transform",`translate(0,${height})`)
    .call(xAxis);

svg.append("g")
    .attr("class","y axis")
    .call(yAxis);

// Tooltip
const tooltip = d3.select("#tooltip");

// Draw tasks
svg.selectAll(".task")
    .data(data)
    .enter()
    .append("rect")
    .attr("class","task")
    .attr("x", d=>x(d.start))
    .attr("y", d=>y(d.worker))
    .attr("width", d=>x(d.end)-x(d.start))
    .attr("height", y.bandwidth())
    .attr("fill", d=>color(d.file))
    .on("mouseover", (event,d)=>{
        tooltip.style("visibility","visible")
            .html(`<strong>${d.task}</strong><br/>File: ${d.file}<br/>Start: ${new Date(d.start).toLocaleString()}<br/>End: ${new Date(d.end).toLocaleString()}`);
    })
    .on("mousemove", (event)=>tooltip.style("top",(event.pageY+10)+"px").style("left",(event.pageX+10)+"px"))
    .on("mouseout",()=>tooltip.style("visibility","hidden"));

// Zoom handler
function zoomed(event) {
    const newX = event.transform.rescaleX(x);
    svg.selectAll(".task")
        .attr("x", d=>newX(d.start))
        .attr("width", d=>newX(d.end)-newX(d.start));
    svg.select(".x.axis").call(xAxis.scale(newX));
}

// Resize handling
window.addEventListener("resize",()=> {
    width = document.body.clientWidth - margin.left - margin.right;
    height = document.body.clientHeight - margin.top - margin.bottom;
    x.range([0, width]);
    y.range([0, height]);
    d3.select("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom);
    svg.select(".x.axis")
        .attr("transform",`translate(0,${height})`)
        .call(xAxis);
    svg.select(".y.axis")
        .call(yAxis);
    svg.selectAll(".task")
        .attr("x", d=>x(d.start))
        .attr("y", d=>y(d.worker))
        .attr("width", d=>x(d.end)-x(d.start))
        .attr("height", y.bandwidth());
});
</script>
</body>
</html>