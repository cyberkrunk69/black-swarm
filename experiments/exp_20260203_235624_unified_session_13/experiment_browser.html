<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Experiment Browser Panel</title>
    <style>
        body {font-family: Arial, sans-serif; margin: 20px;}
        .exp-item {border: 1px solid #ccc; padding: 10px; margin-bottom: 8px; cursor: pointer;}
        .exp-header {display: flex; justify-content: space-between; align-items: center;}
        .exp-details {margin-top: 5px; display: none;}
        .file-list {margin-left: 20px;}
        .status-success {color: green;}
        .status-fail {color: red;}
        a.diff-link {margin-left: 10px; font-size: 0.9em;}
    </style>
</head>
<body>
    <h1>Experiment Browser</h1>
    <div id="expContainer">Loading experiments...</div>

    <script>
        // Utility to format timestamp
        function formatTs(ts) {
            const d = new Date(ts);
            return d.toLocaleString();
        }

        // Mock data â€“ replace with real data fetching logic
        const experiments = [
            {
                name: "exp_20260203_235624_unified_session_13",
                timestamp: 1706986584000,
                taskCount: 5,
                filesCreated: 12,
                status: "success",
                files: [
                    "main.py",
                    "README.md",
                    "results/output.txt",
                    "diffs/patch.diff"
                ]
            },
            {
                name: "exp_20260202_101010_sample_test",
                timestamp: 1706890181000,
                taskCount: 3,
                filesCreated: 7,
                status: "fail",
                files: [
                    "script.py",
                    "log.txt"
                ]
            }
        ];

        function createExpItem(exp) {
            const container = document.createElement('div');
            container.className = 'exp-item';

            const header = document.createElement('div');
            header.className = 'exp-header';
            header.innerHTML = `
                <span><strong>${exp.name}</strong> (${formatTs(exp.timestamp)})</span>
                <span>
                    Tasks: ${exp.taskCount} |
                    Files: ${exp.filesCreated} |
                    Status: <span class="${exp.status === 'success' ? 'status-success' : 'status-fail'}">${exp.status}</span>
                </span>
            `;

            const details = document.createElement('div');
            details.className = 'exp-details';
            const fileList = document.createElement('ul');
            fileList.className = 'file-list';
            exp.files.forEach(f => {
                const li = document.createElement('li');
                li.textContent = f;
                if (f.endsWith('.diff') || f.includes('diff')) {
                    const diffLink = document.createElement('a');
                    diffLink.href = `#`; // placeholder, replace with actual diff view URL
                    diffLink.className = 'diff-link';
                    diffLink.textContent = '[view diff]';
                    li.appendChild(diffLink);
                }
                fileList.appendChild(li);
            });
            details.appendChild(fileList);

            header.addEventListener('click', () => {
                details.style.display = details.style.display === 'none' ? 'block' : 'none';
            });

            container.appendChild(header);
            container.appendChild(details);
            return container;
        }

        function renderExperiments() {
            const container = document.getElementById('expContainer');
            container.innerHTML = '';
            experiments.forEach(exp => {
                container.appendChild(createExpItem(exp));
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', renderExperiments);
    </script>
</body>
</html>