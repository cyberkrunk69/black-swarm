:root {
  /* Base delay – each deeper node adds 80ms */
  --thunk-base-delay: 0ms;
  --thunk-stagger: 80ms;
}

/* Helper to compute delay for a given depth (set via inline style or JS) */
.thunk-node[data-depth] {
  --thunk-delay: calc(var(--thunk-base-delay) + (var(--thunk-stagger) * var(--thunk-depth)));
}

/* Collapse animation for nodes */
.thunk-node.collapse {
  animation: thunk-node-collapse 300ms forwards;
  animation-delay: var(--thunk-delay);
}

/* Collapse animation for connection lines */
.thunk-connection.collapse {
  animation: thunk-connection-retract 300ms forwards;
  animation-delay: var(--thunk-delay);
}

/* Keyframes for node shrink‑and‑translate */
@keyframes thunk-node-collapse {
  from {
    transform: scale(1) translate(0, 0);
    opacity: 1;
  }
  to {
    /* --collapse-x / --collapse-y should be set on the element to indicate the collapse point */
    transform: scale(0) translate(var(--collapse-x, 0), var(--collapse-y, 0));
    opacity: 0;
  }
}

/* Keyframes for line retraction */
@keyframes thunk-connection-retract {
  from {
    stroke-dashoffset: 0;
    opacity: 1;
  }
  to {
    stroke-dashoffset: 100%; /* assumes dasharray set to length */
    opacity: 0;
  }
}

/* Optional: make dasharray equal to path length automatically */
.thunk-connection {
  stroke-dasharray: 1000; /* placeholder, override with JS if needed */
  stroke-dashoffset: 0;
}