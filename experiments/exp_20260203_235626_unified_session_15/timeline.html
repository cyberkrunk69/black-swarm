<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Parallel Execution Timeline</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body { margin:0; font-family:Arial,Helvetica,sans-serif; }
        #chart { width:100vw; height:100vh; }
    </style>
</head>
<body>
<div id="chart"></div>
<script>
/**
 * Expected data format (replace with real data):
 * const tasks = [
 *   {name: "Task A", start: "2026-02-04T10:00:00", end: "2026-02-04T10:05:00", file: "src/module_a.py"},
 *   {name: "Task B", start: "2026-02-04T10:02:00", end: "2026-02-04T10:07:00", file: "src/module_b.py"},
 *   ...
 * ];
 *
 * The chart groups tasks by worker slot (y-axis). For demo we generate random slots.
 */
const tasks = [
    {name: "Load Data", start: "2026-02-04T09:00:00", end: "2026-02-04T09:02:00", file: "data_loader.py"},
    {name: "Preprocess", start: "2026-02-04T09:01:30", end: "2026-02-04T09:04:00", file: "preprocess.py"},
    {name: "Train Model", start: "2026-02-04T09:04:00", end: "2026-02-04T09:10:00", file: "train.py"},
    {name: "Validate", start: "2026-02-04T09:08:00", end: "2026-02-04T09:12:00", file: "validate.py"},
    {name: "Export Results", start: "2026-02-04T09:11:00", end: "2026-02-04T09:13:00", file: "export.py"}
];

// Assign a worker slot (0..N-1) â€“ in real use this would come from the log.
tasks.forEach((t, i) => t.slot = i % 3); // demo: 3 workers

// Build Plotly traces (one per worker slot)
const slots = [...new Set(tasks.map(t => t.slot))];
const colors = Plotly.d3.scaleOrdinal(Plotly.d3.schemeCategory10);

const data = slots.map(slot => {
    const slotTasks = tasks.filter(t => t.slot === slot);
    return {
        type: "bar",
        orientation: "h",
        y: slotTasks.map(t => `Worker ${slot}`),
        x: slotTasks.map(t => new Date(t.end) - new Date(t.start)), // duration ms
        base: slotTasks.map(t => new Date(t.start)),
        text: slotTasks.map(t => `${t.name}<br>${t.file}`),
        hoverinfo: "text",
        marker: {
            color: slotTasks.map(t => colors(t.file))
        },
        width: 0.4,
        name: `Worker ${slot}`
    };
});

const layout = {
    title: "Parallel Execution Timeline",
    barmode: "stack",
    xaxis: {
        type: "date",
        title: "Time",
        rangeselector: {buttons: [
            {count: 1, label: "1 min", step: "minute", stepmode: "backward"},
            {count: 5, label: "5 min", step: "minute", stepmode: "backward"},
            {step: "all"}
        ]},
        rangeslider: {visible: true}
    },
    yaxis: {
        automargin: true,
        title: "Worker Slot",
        tickmode: "array",
        tickvals: slots.map(s => `Worker ${s}`),
        ticktext: slots.map(s => `Worker ${s}`)
    },
    hovermode: "closest",
    dragmode: "pan"
};

Plotly.newPlot('chart', data, layout, {responsive: true});
</script>
</body>
</html>