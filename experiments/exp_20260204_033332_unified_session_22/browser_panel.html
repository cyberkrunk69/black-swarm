<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Experiment Browser Panel</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .exp-list { border-collapse: collapse; width: 100%; }
        .exp-list th, .exp-list td { border: 1px solid #ddd; padding: 8px; }
        .exp-list th { background-color: #f2f2f2; }
        .file-list { margin-left: 20px; display: none; }
        .toggle { cursor: pointer; color: #0066cc; text-decoration: underline; }
        .status-success { color: green; }
        .status-fail { color: red; }
    </style>
</head>
<body>
    <h1>Experiment Browser Panel</h1>
    <table class="exp-list">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Experiment Folder</th>
                <th>Task Count</th>
                <th>Files Created</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="exp-body">
            <!-- Rows will be injected by script -->
        </tbody>
    </table>

    <script>
        // Mock data â€“ replace with real data generation as needed
        const experiments = [
            {
                timestamp: "2026-02-04 03:33:32",
                folder: "exp_20260204_033332_unified_session_22",
                taskCount: 7,
                filesCreated: 12,
                status: "success",
                files: [
                    "browser_panel.html",
                    "analysis.txt",
                    "results.json"
                ]
            },
            {
                timestamp: "2026-02-03 22:15:10",
                folder: "exp_20260203_221510_data_cleanup",
                taskCount: 4,
                filesCreated: 5,
                status: "fail",
                files: [
                    "cleanup_script.py",
                    "log.txt"
                ]
            },
            {
                timestamp: "2026-02-02 18:45:00",
                folder: "exp_20260202_184500_model_train",
                taskCount: 10,
                filesCreated: 8,
                status: "success",
                files: [
                    "train.py",
                    "model.h5",
                    "metrics.csv"
                ]
            }
        ];

        function createRow(exp, index) {
            const tr = document.createElement('tr');

            const tdTimestamp = document.createElement('td');
            tdTimestamp.textContent = exp.timestamp;
            tr.appendChild(tdTimestamp);

            const tdFolder = document.createElement('td');
            const toggle = document.createElement('span');
            toggle.textContent = exp.folder;
            toggle.className = 'toggle';
            toggle.dataset.idx = index;
            toggle.onclick = () => toggleFiles(index);
            tdFolder.appendChild(toggle);
            tr.appendChild(tdFolder);

            const tdTasks = document.createElement('td');
            tdTasks.textContent = exp.taskCount;
            tr.appendChild(tdTasks);

            const tdFiles = document.createElement('td');
            tdFiles.textContent = exp.filesCreated;
            tr.appendChild(tdFiles);

            const tdStatus = document.createElement('td');
            tdStatus.textContent = exp.status;
            tdStatus.className = exp.status === 'success' ? 'status-success' : 'status-fail';
            tr.appendChild(tdStatus);

            return tr;
        }

        function createFileList(exp) {
            const div = document.createElement('div');
            div.className = 'file-list';
            div.id = `files-${exp.folder}`;

            const ul = document.createElement('ul');
            exp.files.forEach(file => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#`; // placeholder for diff view link
                a.textContent = file;
                a.title = "View diffs";
                li.appendChild(a);
                ul.appendChild(li);
            });
            div.appendChild(ul);
            return div;
        }

        function toggleFiles(idx) {
            const exp = experiments[idx];
            const listId = `files-${exp.folder}`;
            let listDiv = document.getElementById(listId);
            if (!listDiv) {
                // create and insert after the row
                const tr = document.querySelectorAll('#exp-body tr')[idx];
                listDiv = createFileList(exp);
                tr.parentNode.insertBefore(listDiv, tr.nextSibling);
            }
            listDiv.style.display = listDiv.style.display === 'none' ? 'block' : 'none';
        }

        // Populate table
        const tbody = document.getElementById('exp-body');
        experiments.forEach((exp, i) => {
            tbody.appendChild(createRow(exp, i));
        });
    </script>
</body>
</html>