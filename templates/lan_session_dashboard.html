<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LAN Session Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .section { margin-bottom: 30px; }
    </style>
</head>
<body>
    <h1>LAN Session Dashboard</h1>
    <div id="sessions"></div>

    <script>
        const ws = new WebSocket(`ws://${location.host}/ws/lan-sessions`);
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            renderSessions(data.sessions);
        };
        ws.onclose = () => {
            const div = document.getElementById('sessions');
            div.innerHTML = '<p>Connection closed. Refresh to reconnect.</p>';
        };

        function renderSessions(sessions) {
            const container = document.getElementById('sessions');
            if (sessions.length === 0) {
                container.innerHTML = '<p>No active LAN sessions.</p>';
                return;
            }

            let html = '';
            sessions.forEach(sess => {
                html += `<div class="section">
                    <h2>IP: ${sess.ip}</h2>
                    <p>Last Active: ${new Date(sess.last_active).toLocaleString()}</p>

                    <h3>Your Tasks</h3>
                    ${renderTable(sess.tasks, ['timestamp', 'action', 'details'])}

                    <h3>Network Activity</h3>
                    ${renderTable(sess.network_activity, ['timestamp', 'src', 'dst', 'protocol', 'size'])}
                </div>`;
            });
            container.innerHTML = html;
        }

        function renderTable(rows, columns) {
            if (!rows || rows.length === 0) {
                return '<p>(none)</p>';
            }
            let header = '<tr>' + columns.map(col => `<th>${col}</th>`).join('') + '</tr>';
            let body = rows.map(row => {
                return '<tr>' + columns.map(col => `<td>${row[col] ?? ''}</td>`).join('') + '</tr>';
            }).join('');
            return `<table>${header}${body}</table>`;
        }
    </script>
</body>
</html>