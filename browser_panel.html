<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Experiment Browser Panel</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .exp-item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; cursor: pointer; }
        .exp-header { display: flex; justify-content: space-between; }
        .exp-details { margin-top: 5px; font-size: 0.9em; color: #555; }
        .file-list { margin-top: 10px; display: none; }
        .file-list ul { list-style: none; padding-left: 0; }
        .file-list li { margin: 2px 0; }
        .diff-link { margin-left: 5px; font-size: 0.8em; }
    </style>
</head>
<body>
    <h1>Recent Experiments</h1>
    <div id="experiments"></div>

    <script>
        // Mock data – replace with server‑side rendering or API call as needed
        const experiments = [
            {
                folder: "exp_20260204_033714_unified_session_22",
                timestamp: "2026-02-04 03:37:14",
                taskCount: 5,
                filesCreated: 12,
                status: "success",
                files: [
                    "main.py",
                    "utils.py",
                    "README.md",
                    "requirements.txt",
                    "output.log"
                ]
            },
            {
                folder: "exp_20260203_221045_data_cleanup",
                timestamp: "2026-02-03 22:10:45",
                taskCount: 3,
                filesCreated: 8,
                status: "fail",
                files: [
                    "cleanup.py",
                    "report.txt",
                    "error.log"
                ]
            }
            // Add more entries dynamically
        ];

        const container = document.getElementById('experiments');

        experiments.forEach(exp => {
            const expDiv = document.createElement('div');
            expDiv.className = 'exp-item';

            const header = document.createElement('div');
            header.className = 'exp-header';
            header.innerHTML = `<strong>${exp.folder}</strong> <span>Status: ${exp.status}</span>`;
            expDiv.appendChild(header);

            const details = document.createElement('div');
            details.className = 'exp-details';
            details.textContent = `Timestamp: ${exp.timestamp} | Tasks: ${exp.taskCount} | Files: ${exp.filesCreated}`;
            expDiv.appendChild(details);

            const fileList = document.createElement('div');
            fileList.className = 'file-list';
            const ul = document.createElement('ul');
            exp.files.forEach(f => {
                const li = document.createElement('li');
                li.innerHTML = `${f} <a class="diff-link" href="#" onclick="viewDiff('${exp.folder}', '${f}'); return false;">[diff]</a>`;
                ul.appendChild(li);
            });
            fileList.appendChild(ul);
            expDiv.appendChild(fileList);

            // Toggle file list on click
            expDiv.addEventListener('click', (e) => {
                // Prevent toggling when clicking a diff link
                if (e.target.tagName.toLowerCase() === 'a') return;
                fileList.style.display = fileList.style.display === 'none' ? 'block' : 'none';
            });

            container.appendChild(expDiv);
        });

        function viewDiff(folder, file) {
            // Placeholder – implement diff view logic (e.g., open modal or new window)
            alert(`View diff for ${folder}/${file}`);
        }
    </script>
</body>
</html>