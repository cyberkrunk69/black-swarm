<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Parallel Execution Timeline (Gantt)</title>
    <style>
        body { font-family: Arial, sans-serif; margin:0; overflow:hidden; }
        .axis line, .axis path { stroke: #888; }
        .task { stroke: #333; stroke-width: 1px; }
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.7);
            color: #fff;
            padding: 5px 8px;
            border-radius: 3px;
            pointer-events: none;
            font-size: 12px;
            visibility: hidden;
        }
    </style>
</head>
<body>
<div id="chart"></div>
<div class="tooltip" id="tooltip"></div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
// -------------------- Mock Data --------------------
// Replace this with your actual data source.
const tasks = [
    // {id, name, start, end, worker, origin}
    {id:1, name:"Task A", start:0, end:30, worker:0, origin:"module_a.py"},
    {id:2, name:"Task B", start:10, end:50, worker:1, origin:"module_b.py"},
    {id:3, name:"Task C", start:20, end:70, worker:0, origin:"module_a.py"},
    {id:4, name:"Task D", start:60, end:120, worker:2, origin:"module_c.py"},
    {id:5, name:"Task E", start:80, end:130, worker:1, origin:"module_b.py"},
    // add more tasks as needed
];

// -------------------- Config --------------------
const margin = {top: 20, right: 20, bottom: 30, left: 100};
const width = window.innerWidth - margin.left - margin.right;
const height = window.innerHeight - margin.top - margin.bottom;
const rowHeight = 30;
const workerCount = d3.max(tasks, d=>d.worker)+1;

// -------------------- Scales --------------------
const x = d3.scaleLinear()
    .domain([d3.min(tasks, d=>d.start), d3.max(tasks, d=>d.end)])
    .range([0, width]);

const y = d3.scaleBand()
    .domain(d3.range(workerCount))
    .range([0, workerCount*rowHeight])
    .padding(0.1);

// Color scale by origin file
const origins = Array.from(new Set(tasks.map(d=>d.origin)));
const color = d3.scaleOrdinal()
    .domain(origins)
    .range(d3.schemeTableau10);

// -------------------- SVG --------------------
const svg = d3.select("#chart")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", workerCount*rowHeight + margin.top + margin.bottom)
    .call(d3.zoom().scaleExtent([0.5, 10]).on("zoom", zoomed))
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

const xAxis = d3.axisBottom(x).ticks(10).tickFormat(d=>`${d}s`);
const yAxis = d3.axisLeft(y).tickFormat(d=>`Worker ${d}`);

svg.append("g")
    .attr("class", "x axis")
    .attr("transform", `translate(0,${workerCount*rowHeight})`)
    .call(xAxis);

svg.append("g")
    .attr("class", "y axis")
    .call(yAxis);

// -------------------- Draw Tasks --------------------
const tooltip = d3.select("#tooltip");

svg.selectAll(".task")
    .data(tasks)
    .enter()
    .append("rect")
    .attr("class", "task")
    .attr("x", d=>x(d.start))
    .attr("y", d=>y(d.worker))
    .attr("width", d=>x(d.end)-x(d.start))
    .attr("height", y.bandwidth())
    .attr("fill", d=>color(d.origin))
    .on("mouseover", (event,d) => {
        tooltip.style("visibility","visible")
               .html(`<strong>${d.name}</strong><br/>
                      Origin: ${d.origin}<br/>
                      Start: ${d.start}s<br/>
                      End: ${d.end}s`);
    })
    .on("mousemove", (event) => {
        tooltip.style("top", (event.pageY+10)+"px")
               .style("left", (event.pageX+10)+"px");
    })
    .on("mouseout", () => tooltip.style("visibility","hidden"));

// -------------------- Zoom / Pan --------------------
function zoomed(event) {
    const newX = event.transform.rescaleX(x);
    const newY = event.transform.rescaleY(y);

    svg.selectAll(".task")
        .attr("x", d=>newX(d.start))
        .attr("width", d=>newX(d.end)-newX(d.start))
        .attr("y", d=>newY(d.worker))
        .attr("height", newY.bandwidth());

    svg.select(".x.axis").call(d3.axisBottom(newX).ticks(10).tickFormat(d=>`${d}s`));
    svg.select(".y.axis").call(d3.axisLeft(newY).tickFormat(d=>`Worker ${d}`));
}

// Resize handling
window.addEventListener('resize', () => {
    const newWidth = window.innerWidth - margin.left - margin.right;
    const newHeight = workerCount*rowHeight - margin.top - margin.bottom;

    d3.select("svg")
        .attr("width", newWidth + margin.left + margin.right)
        .attr("height", workerCount*rowHeight + margin.top + margin.bottom);

    x.range([0, newWidth]);
    svg.select(".x.axis").attr("transform", `translate(0,${workerCount*rowHeight})`).call(xAxis);
    svg.selectAll(".task")
        .attr("x", d=>x(d.start))
        .attr("width", d=>x(d.end)-x(d.start));
});
</script>
</body>
</html>