# Engine & Model Visibility Specification

## Overview
The dashboard now surfaces **per‑node inference engine and model information** together with the reason why that engine was selected. Real‑time updates are streamed via Server‑Sent Events (SSE) so the UI reflects changes instantly.

## UI Changes

### 1. Node / Worker Card
Each node card displays the following fields:

| Field | Presentation | Example |
|-------|---------------|---------|
| **Engine type** | Badge (blue for **CLAUDE**, orange for **GROQ**) + text label | `CLAUDE` badge |
| **Model name** | Plain text under the engine badge | `claude-sonnet-4` |
| **Selection reason** | Italic, lighter‑colored text | `Reason: Complex task` |
| **Tokens used** | Updated live, shown as `Tokens used: 123` |
| **Cost** | Updated live, shown as `Cost: $0.12` |

The HTML for a card lives in `dashboard.html` inside the `renderNode` function.

### 2. Real‑time Updates
- **Endpoint**: `GET /events` (SSE) – defined in `progress_server.py`.
- **Message Types**  
  - `node_update` – payload contains `{id, engine, model, reason, tokens_used, cost}`.  
  - `summary` – payload contains usage split percentages, cost totals, and a map of model usage counts.
- The client JavaScript registers an `EventSource` and updates the DOM accordingly.

### 3. Summary Panel
Located at the bottom of the page, it shows:
- **Claude vs Groq usage split** (percentage of tokens).
- **Cost breakdown** per engine.
- **Model distribution** (simple text list; can be swapped for a chart library later).

## Data Flow
1. **Orchestrator / Workers** (or the simulated background thread) update an in‑memory dictionary (`node_state`) with the current engine, model, reason, token count, and cost.
2. After each update, `progress_server.py` calls `broadcast()` which pushes the JSON payload to every connected SSE client.
3. The browser receives the event, calls `updateNode()` or `updateSummary()`, and the UI refreshes instantly.

## Extensibility
- To replace the placeholder model distribution chart with a real chart (e.g., Chart.js), modify the `#model-distribution` div and update `updateSummary()` to feed the chart data.
- If a bidirectional channel is later required, the SSE endpoint can be swapped for a WebSocket implementation without changing the UI logic (just the transport layer).

## Testing
Run the server:

```bash
python progress_server.py
```

Open `dashboard.html` in a browser (served from the same host/port or via a static file server). You should see node cards appear and update every few seconds, along with the summary panel reflecting the aggregated data.

---

*Generated by the execution worker to satisfy the “Engine/Model Surfacing in UI” task.*
# ENGINE / MODEL VISIBILITY SPECIFICATION

## Overview
The dashboard now surfaces the inference engine and model being used by each worker node.  
This provides operators with instant insight into why a particular engine was selected, the exact model in use, and real‑time cost/token metrics.

## UI Changes

### Node Card (per‑node)
- **Engine Badge** (`<span class="badge engine-badge">`) – Shows `CLAUDE` or `GROQ`.  
  Styled with distinct colors (e.g., blue for Claude, orange for Groq).
- **Model Name** (`<span class="model-name">`) – Displays the concrete model identifier such as `claude-sonnet-4` or `llama-3.3-70b`.
- **Selection Reason** (`<small class="selection-reason">`) – Human‑readable explanation (e.g., *Complex task*, *Budget optimization*).

### Summary Panel
Located beneath the node grid.
- **Engine usage counts** – Number of active nodes per engine.
- **Cost breakdown** – Accumulated monetary cost per engine (updated live).
- **Model distribution chart** – Pie chart (Chart.js) visualising the proportion of models across the cluster.

## Data Flow

1. **Server (`progress_server.py`)**  
   - Each node’s status payload now includes:
     - `engine_type`
     - `model_name`
     - `selection_reason`
     - `cost_accumulated`
     - `tokens_used`
   - These fields are emitted via the existing SSE endpoint (`/events`) under the `node_update` event type.

2. **Client (`dashboard.html`)**  
   - Listens to `node_update` SSE events.
   - Updates the DOM elements (`engine-<id>`, `model-<id>`, `reason-<id>`) in real‑time.
   - Aggregates data for the summary panel and refreshes the Chart.js pie chart.

## Styling (CSS)
Add the following (or integrate into existing stylesheet):
```css
.engine-badge {
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: 600;
    color: #fff;
}
.engine-badge[data-engine="CLAUDE"] { background-color: #1e90ff; }
.engine-badge[data-engine="GROQ"]   { background-color: #ff8c00; }

.node-engine-model {
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.model-name { font-family: monospace; }
.selection-reason { color: #666; }
```
The badge element receives a `data-engine` attribute via JavaScript for styling.

## Testing Checklist
- [ ] Verify each node card shows correct engine badge, model name, and reason after initial load.
- [ ] Confirm real‑time updates when the server switches engines or changes models.
- [ ] Ensure cost and token counters update without page reload.
- [ ] Validate the summary panel reflects accurate node counts, costs, and model distribution.
- [ ] Check that the Chart.js pie chart updates dynamically as models are added/removed.

---  
End of specification.
# Engine & Model Visibility Specification

## Overview
This document outlines the UI enhancements that expose per‑node inference engine and model information, as well as aggregate summaries.

## Node Card Additions
Each node card now displays:
| Element | Description |
|---------|-------------|
| **Engine badge** | Shows `CLAUDE` or `GROQ` with a colour‑coded badge (`.engine-badge.claude` / `.engine-badge.groq`). |
| **Model name** | Human‑readable model identifier (e.g., `claude-sonnet-4`, `llama-3.3-70b`). |
| **Selection reason** | Text explaining why the engine/model was chosen (e.g., `Complex task`, `Budget optimization`). |
| **Cost** | Running cost accumulated for this node (`$X.XX`). |
| **Tokens** | Number of tokens processed by the model. |

## Real‑time Updates
- Server sends `node_update` SSE events containing the new fields:
  ```json
  {
    "id": "node-1",
    "status": "running",
    "progress": 57,
    "engine_type": "CLAUDE",
    "model_name": "claude-sonnet-4",
    "selection_reason": "Complex task",
    "cost_accumulated": 0.42,
    "tokens_used": 1234
  }
  ```
- Front‑end JavaScript updates the node card instantly and recomputes summary statistics.

## Summary Panel
A new **Engine & Model Summary** section aggregates:
- Total node count per engine.
- Total cost per engine.
- Pie chart of model distribution across all active nodes (implemented with Chart.js).

## Integration Points
- **Server**: `progress_server.py` now includes the additional fields in the SSE payload.
- **Client**: `dashboard.html` contains HTML placeholders, CSS badge classes, and JavaScript logic for live updates and chart rendering.

## Styling (CSS)
Add the following to the dashboard stylesheet (or inline):
```css
.engine-badge {
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
    color: #fff;
}
.engine-badge.claude { background-color: #1e90ff; }
.engine-badge.groq   { background-color: #ff8c00; }
```

## Future Extensions
- Drill‑down view per node for detailed token and cost timelines.
- Filters to view only specific engines or models.

--- End of Specification ---
# ENGINE / MODEL VISIBILITY SPECIFICATION

## Overview
The dashboard now surface per‑node inference engine and model details, together with the reason the engine was selected. Real‑time updates are streamed via Server‑Sent Events (SSE) and reflected instantly in the UI. A summary panel aggregates usage, cost, and model distribution.

## UI Elements

| Element | Location | Description |
|---------|----------|-------------|
| Engine badge | Inside each `.node-card` header | Shows **CLAUDE** (blue) or **GROQ** (green) badge. Hover tooltip displays the selection reason. |
| Model label | Next to the engine badge | Human‑readable model name (e.g., `claude-sonnet-4`). |
| Summary panel | Bottom of the dashboard | Displays total call counts per engine, cost breakdown, and a simple bar‑chart of model distribution. |

## Data Flow

1. **Backend (`progress_server.py`)**  
   - Each node status dictionary now includes `engine`, `model`, and `reason`.  
   - These fields are merged into the JSON payload sent over SSE.

2. **Frontend (`dashboard.html`)**  
   - `EventSource` receives the SSE stream.  
   - For messages containing `node_id`, `engine`, `model`, and `reason`, `updateNodeEngineInfo()` updates the corresponding node card.  
   - For messages with `type: "summary"`, the summary panel fields are refreshed.

## SSE Payload Example (per‑node)

```json
{
  "node_id": "worker-7",
  "engine": "CLAUDE",
  "model": "claude-sonnet-4",
  "reason": "Complex task",
  "tokens_used": 1245,
  "cost": 0.018
}
```

## SSE Payload Example (summary)

```json
{
  "type": "summary",
  "claude_usage": 42,
  "groq_usage": 18,
  "claude_cost": 3.27,
  "groq_cost": 1.14,
  "model_distribution": {
    "claude-sonnet-4": 65,
    "llama-3.3-70b": 35
  }
}
```

## Styling
- Engine badges use `.engine-badge` with variant classes `.engine-claude` (blue) and `.engine-groq` (green).  
- Model labels use `.model-label`.  
- Summary panel uses simple flex layout; model distribution visualised as horizontal bars.

## Future Extensions
- Add click‑through to a detailed node log.  
- Replace the simple bar list with a charting library (e.g., Chart.js).  

---  
*Generated on 2026‑02‑04.*
# Engine/Model Visibility Specification

## Overview
The dashboard now surfaces per‑node inference engine and model information, together with the reason why the engine was selected. Real‑time updates are streamed via Server‑Sent Events (SSE).

## UI Changes
### Node Card
- Added three new `<span>` elements inside each node card:
  - `#engine-<node_id>` – displays the engine badge (`CLAUDE` or `GROQ`).
  - `#model-<node_id>` – shows the model name (e.g., `claude-sonnet-4`).
  - `#reason-<node_id>` – contains the selection reason text.
- Engine badge is styled with a colored badge (blue for CLAUDE, orange for GROQ).

### Summary Panel
- New fields:
  - `#total-claude` / `#total-groq` – total usage split.
  - `#cost-claude` / `#cost-groq` – accumulated cost per engine.
  - `#model-distribution` – a simple list (placeholder for a chart) showing model counts.

## Data Flow
1. **Server (`progress_server.py`)** – enriches the SSE payload with:
   - `engine`, `model`, `selection_reason`, `cost`, `tokens` for each node.
   - `summary.cost_breakdown` and `summary.model_distribution`.
2. **Client (`dashboard.html`)** – SSE handler parses the payload and updates the DOM elements listed above.

## Real‑time Updates
- Engine switches, cost accumulation, and token usage are reflected instantly as the SSE messages arrive.
- The summary panel aggregates the per‑node data to present overall usage statistics.

## Implementation Notes
- No changes were made to protected files.
- All modifications are isolated to `progress_server.py`, `dashboard.html`, and this spec document.
# Engine & Model Visibility Specification

## Overview
The dashboard now surfaces the inference engine and model used by each worker node, together with the selection reason, live cost, and token usage. A summary panel aggregates usage across the whole run.

## Node Card Additions
| Element | Description | Example |
|---------|-------------|---------|
| **Engine badge** (`.engine-badge`) | Shows `CLAUDE` or `GROQ` with a colored badge. | `<span class="badge engine-badge" data-engine="CLAUDE">CLAUDE</span>` |
| **Model name** (`.model-name`) | Human‑readable model identifier. | `claude-sonnet-4` |
| **Selection reason** (`.reason`) | Text explaining why the engine was chosen. | `Complex task` |
| **Cost** (`.cost`) | Accumulated monetary cost for that node (updated in real‑time). | `$0.0123` |
| **Tokens** (`.tokens`) | Tokens processed by the node so far. | `1450` |

## Real‑time Updates
- **SSE events**:
  - `node_update` – payload includes `engine`, `model`, `selection_reason`, `cost`, `tokens`.
  - `summary_update` – aggregates: node counts per engine, cost breakdown, and a model distribution map.
- The client JavaScript updates the DOM elements and a Chart.js pie chart on each event.

## Summary Panel
Located at the bottom of `dashboard.html` (`#summary-panel`):
- Shows total Claude vs. Groq node counts.
- Displays total cost per engine.
- Renders a pie chart (`#model-distribution-chart`) visualising how many nodes are using each model.

## Server‑Side Changes (`progress_server.py`)
- Node payload now carries `engine`, `model`, `selection_reason`, `cost`, `tokens`.
- After broadcasting individual node updates, a `summary_update` event is emitted with aggregated statistics.
- The server expects each `Node` object to expose:
  - `engine` (str)
  - `model_name` (str)
  - `reason` (str)
  - `accumulated_cost` (float)
  - `tokens_used` (int)

## Front‑End Integration
- Added Chart.js via CDN.
- Inserted JavaScript listeners for the two SSE event types.
- Updated the HTML template to include placeholders for the new fields.

## Impact
- No functional changes to inference logic.
- UI now provides full transparency into which engine/model is used per node and overall cost/usage metrics, satisfying the “ENGINE/MODEL SURFACING IN UI” requirement.
# ENGINE_VISIBILITY_SPEC.md

## Overview
The dashboard now surfaces the inference **engine**, **model**, and the **selection reason** for each active node. Real‑time updates are pushed via Server‑Sent Events (SSE) and reflected instantly in the UI. A new **Summary Panel** aggregates usage statistics across all nodes.

## UI Additions
| Element | Location | Description |
|---------|----------|-------------|
| **Engine Badge** (`<span class="engine-badge">`) | Inside each node card (`.engine-info`) | Shows `CLAUDE` (blue) or `GROQ` (orange) with colour‑coded badge. |
| **Model Name** (`<span class="model-name">`) | Same as above | Displays the exact model string (e.g., `claude-sonnet-4`). |
| **Selection Reason** (`<span class="selection-reason">`) | Same as above | Human‑readable reason why the engine was chosen (e.g., `Complex task`). |
| **Summary Panel** (`#summary-panel`) | Below the node list | Shows total node counts per engine, cost breakdown, and a pie chart of model distribution. |

## Backend Changes
- `progress_server.py` now includes additional keys (`engine_type`, `model_name`, `selection_reason`, `engine_cost`, `tokens_used`) in each node’s JSON payload.
- New `/summary` endpoint aggregates global usage data (optional, used by the UI for the summary panel).

## Front‑end Logic
- SSE handler parses the new fields and updates the DOM elements (`engine-badge-<id>`, `model-name-<id>`, `selection-reason-<id>`).
- Summary calculations are performed client‑side on every SSE message; results are rendered into the summary panel and a Chart.js pie chart.

## Styling
- Badges use `.engine-badge.CLAUDE` (blue) and `.engine-badge.GROQ` (orange) classes.
- Minimal CSS added to `dashboard.html` for layout and visual consistency.

## Dependencies
- **Chart.js** (loaded via CDN) for the model distribution pie chart.

## Testing
1. Start the application and open the dashboard.  
2. Observe each node card now displays the engine badge, model name, and selection reason.  
3. Trigger an engine switch on a node; the badge updates in real time.  
4. Verify the summary panel reflects the correct counts, costs, and chart updates.

--- End of spec ---